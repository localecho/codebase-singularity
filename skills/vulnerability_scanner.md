---
name: vulnerability_scanner
description: ML-powered security scanning for code vulnerabilities
triggers:
  - scan security
  - find vulnerabilities
  - security audit
---

# Skill: Code Vulnerability ML Scanner

## Overview

ML-powered security scanning with CVE pattern matching, vulnerability prediction, supply chain risk scoring, and SAST integration.

---

## Architecture

```
┌─────────────────────────────────────────────────────────────┐
│              VULNERABILITY SCANNER PIPELINE                 │
│                                                             │
│   Source Code                                               │
│        │                                                    │
│        ▼                                                    │
│   ┌─────────────────────────────────────────────────────┐  │
│   │              STATIC ANALYSIS (SAST)                  │  │
│   │  - AST parsing                                       │  │
│   │  - Data flow analysis                                │  │
│   │  - Taint tracking                                    │  │
│   └─────────────────────────────────────────────────────┘  │
│        │                                                    │
│        ▼                                                    │
│   ┌─────────────────────────────────────────────────────┐  │
│   │              CVE PATTERN MATCHING                    │  │
│   │  - Known vulnerability signatures                    │  │
│   │  - CWE classification                                │  │
│   │  - OWASP Top 10 detection                           │  │
│   └─────────────────────────────────────────────────────┘  │
│        │                                                    │
│        ▼                                                    │
│   ┌─────────────────────────────────────────────────────┐  │
│   │           ML VULNERABILITY PREDICTION                │  │
│   │  - Pattern recognition                               │  │
│   │  - Anomaly detection                                 │  │
│   │  - Risk scoring                                      │  │
│   └─────────────────────────────────────────────────────┘  │
│        │                                                    │
│        ▼                                                    │
│   ┌─────────────────────────────────────────────────────┐  │
│   │           SUPPLY CHAIN ANALYSIS                      │  │
│   │  - Dependency vulnerabilities                        │  │
│   │  - Transitive risk                                   │  │
│   │  - License compliance                                │  │
│   └─────────────────────────────────────────────────────┘  │
│        │                                                    │
│        ▼                                                    │
│   Security Report + Remediation Suggestions                 │
└─────────────────────────────────────────────────────────────┘
```

---

## CVE Pattern Matching

### Vulnerability Database

```yaml
vulnerability_db:
  sources:
    - nvd.nist.gov
    - cve.mitre.org
    - github.com/advisories
    - snyk.io/vuln

  update_frequency: daily

  coverage:
    cves: 200000+
    cwes: 900+
    packages: 1M+
```

### Pattern Categories

```yaml
patterns:
  injection:
    - sql_injection
    - command_injection
    - ldap_injection
    - xpath_injection
    - nosql_injection

  xss:
    - reflected_xss
    - stored_xss
    - dom_based_xss

  authentication:
    - broken_auth
    - session_fixation
    - credential_exposure

  crypto:
    - weak_algorithms
    - hardcoded_secrets
    - insecure_random

  access_control:
    - idor
    - privilege_escalation
    - path_traversal
```

---

## ML Vulnerability Prediction

### Model Architecture

```yaml
ml_model:
  type: transformer_classifier
  base: codebert

  training:
    dataset: sven_security_dataset
    samples: 500000
    languages:
      - python
      - javascript
      - java
      - go
      - rust

  features:
    - code_embeddings
    - ast_features
    - data_flow_graph
    - call_graph_features
```

### Prediction Output

```yaml
prediction:
  vulnerability_type: sql_injection
  confidence: 0.94
  severity: critical
  cwe: CWE-89

  location:
    file: src/db/queries.py
    line: 45
    function: execute_query

  evidence:
    - "User input flows directly to SQL query"
    - "No parameterization detected"
    - "Similar pattern to CVE-2023-12345"

  remediation:
    - "Use parameterized queries"
    - "Apply input validation"
    - "Consider using ORM"
```

---

## Supply Chain Risk Scoring

### Dependency Analysis

```yaml
supply_chain:
  scan_targets:
    - package.json
    - requirements.txt
    - go.mod
    - Cargo.toml
    - pom.xml

  risk_factors:
    direct_vulnerabilities:
      weight: 0.4
      description: "Known CVEs in direct dependencies"

    transitive_vulnerabilities:
      weight: 0.3
      description: "CVEs in dependency tree"

    maintenance_status:
      weight: 0.15
      description: "Last update, maintainer count"

    popularity:
      weight: 0.1
      description: "Download count, stars"

    license_risk:
      weight: 0.05
      description: "License compatibility"
```

### Risk Score Output

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
         SUPPLY CHAIN RISK ASSESSMENT
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  Overall Risk Score: 7.2/10 (HIGH)

  Direct Dependencies: 45
  Transitive Dependencies: 312

  Vulnerabilities Found:
    Critical: 2
    High: 5
    Medium: 12
    Low: 8

  High Risk Packages:
    ❌ lodash@4.17.15 - Prototype pollution
    ❌ axios@0.21.0 - SSRF vulnerability
    ⚠️ express@4.17.1 - DoS potential

  Recommendations:
    1. Upgrade lodash to 4.17.21
    2. Upgrade axios to 1.6.0
    3. Consider express alternatives

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## SAST Integration

### Supported Tools

| Tool | Language | Integration |
|------|----------|-------------|
| Semgrep | Multi | Native |
| Bandit | Python | Native |
| ESLint Security | JS/TS | Native |
| gosec | Go | Native |
| cargo-audit | Rust | Native |
| SpotBugs | Java | Plugin |

### Unified Output

```yaml
finding:
  source: semgrep
  rule: python.lang.security.audit.dangerous-exec
  severity: high
  confidence: high

  location:
    file: src/utils/executor.py
    start_line: 23
    end_line: 25

  code: |
    def run_command(user_input):
        exec(user_input)  # Dangerous!

  message: "Detected dynamic code execution with user input"

  cwe: CWE-94
  owasp: A03:2021

  fix_suggestion:
    description: "Use subprocess with shell=False"
    code: |
      import subprocess
      def run_command(args):
          subprocess.run(args, shell=False)
```

---

## Reporting

### Security Report Format

```yaml
report:
  generated: "2024-01-02T10:30:00Z"
  scan_duration: "45s"

  summary:
    total_findings: 27
    by_severity:
      critical: 2
      high: 8
      medium: 12
      low: 5

    by_category:
      injection: 5
      xss: 3
      auth: 4
      crypto: 6
      other: 9

  compliance:
    owasp_top_10: "3 violations"
    pci_dss: "2 violations"
    gdpr: "1 violation"

  trending:
    new_since_last_scan: 4
    fixed_since_last_scan: 2
    regression: 1
```

---

## Commands

```bash
# Full security scan
/security scan

# Scan specific files
/security scan src/api/

# Supply chain analysis only
/security deps

# Generate compliance report
/security report --format sarif

# Check against specific CVE
/security check CVE-2024-1234
```

---

## Configuration

```yaml
# config/security_scanner.yaml
security:
  enabled: true

  scan:
    on_commit: true
    on_pr: true
    scheduled: daily

  severity_threshold: medium

  supply_chain:
    enabled: true
    block_on_critical: true

  integrations:
    semgrep: true
    snyk: $SNYK_TOKEN
    github_advisories: true

  reporting:
    format: sarif
    notify_slack: $SECURITY_SLACK_WEBHOOK

  exclusions:
    paths:
      - "test/**"
      - "vendor/**"
    rules:
      - "generic.secrets.test"
```

---

*Proactive security scanning for safer code.*
